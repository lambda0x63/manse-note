# 만세력 노트

## 계산 기준

### 사주 계산

#### 연주 (年柱)
- **立春** (입춘) 기준으로 년도 변경
- 입춘 전 전년도 간지 적용
- 입춘 후 당해년도 간지 적용
- 입춘 시각 한국천문연구원 데이터 사용 (매년 2월 3-5일경)
- 계산식 (서기년 - 4) % 60 = **60갑자** 인덱스

#### 월주 (月柱)
- 24절기 중 12절(節) 기준
- 절입 시각 정확히 적용
- 사용 절기 **立春(입춘, 寅) 驚蟄(경칩, 卯) 淸明(청명, 辰) 立夏(입하, 巳) 芒種(망종, 午) 小暑(소서, 未) 立秋(입추, 申) 白露(백로, 酉) 寒露(한로, 戌) 立冬(입동, 亥) 大雪(대설, 子) 小寒(소한, 丑)**
- 절입 전 이전 월 간지
- 절입 후 해당 월 간지

#### 일주 (日柱)
- 기준일 1900년 1월 1일 = 甲戌(갑술)일
- 계산 기준일로부터 경과일수 % 60
- 날짜 변경 **00:00** 기준 (자정)

#### 시주 (時柱)
- 시간별 지지 매핑
  - **23:00-01:00** = 子(자)시
  - **01:00-03:00** = 丑(축)시
  - **03:00-05:00** = 寅(인)시
  - **05:00-07:00** = 卯(묘)시
  - **07:00-09:00** = 辰(진)시
  - **09:00-11:00** = 巳(사)시
  - **11:00-13:00** = 午(오)시
  - **13:00-15:00** = 未(미)시
  - **15:00-17:00** = 申(신)시
  - **17:00-19:00** = 酉(유)시
  - **19:00-21:00** = 戌(술)시
  - **21:00-23:00** = 亥(해)시
- 자시 구분
  - **23:00-24:00** = **夜子時(야자시)** - 당일
  - **00:00-01:00** = **早子時(조자시)** - 당일
- 시간 천간 일간과 시지지 조합으로 계산

#### 시간 보정
- 한국 서머타임
  - 1948-1960년 +1시간
  - 1987-1988년 +1시간
- 진태양시/균시차 미적용 (법정시간 사용)

### 대운 계산

#### 대운수 계산
1. **順行(순행)/逆行(역행)** 판단
   - **順行(순행) 陽干(양간, 甲丙戊庚壬)+男子, 陰干(음간, 乙丁己辛癸)+女子**
   - **逆行(역행) 陽干(양간)+女子, 陰干(음간)+男子**

2. **거리 계산**
   - **順行(순행)** 생일 → 다음 절기까지 일수
   - **逆行(역행)** 생일 → 이전 절기까지 일수

3. **환산 기준**
   - 3일 = 1년 / 1일 = 4개월 / 1시간 = 5일
   - 계산식 일수 ÷ 3 = 대운 시작 나이

#### 대운 간지
- **順行(순행)** 월주에서 순차 진행
- **逆行(역행)** 월주에서 역순 진행
- 주기 10년마다 변경

### 세운 계산
- **60갑자** 순환
- 표시 범위 현재년 기준 -10년 ~ +10년
- 나이 만 나이 계산
- 현재년 하이라이트

### 신살 및 공망 (주요 공식)

#### 주요 귀인 및 길신
- **천을귀인** 일간 기준 (甲戊庚-丑未 / 乙己-子申 / 丙丁-亥酉 / 辛-寅午 / 壬癸-卯巳)
- **문창귀인** 일간별 식신의 록지 (甲-巳 乙-午 丙-申 丁-酉 戊-申 己-酉 庚-亥 辛-子 壬-寅 癸-卯)
- **천덕/월덕귀인** 월지 기준 (**봄-丙/丁 여름-庚/辛 가을-壬/癸 겨울-甲/乙**)

#### 삼합 기반 신살
- **역마살** 삼합 첫 글자와 沖(충)하는 지지 (亥卯未(해묘미)-巳 / 寅午戌(인오술)-申 / 巳酉丑(사유축)-亥 / 申子辰(신자진)-寅)
- **도화살** 삼합 첫 글자 다음 지지 / 浴(욕)지 (亥卯未(해묘미)-子 / 寅午戌(인오술)-卯 / 巳酉丑(사유축)-午 / 申子辰(신자진)-酉)
- **화개살** 삼합의 끝 글자 / 庫(고)지 (亥卯未(해묘미)-未 / 寅午戌(인오술)-戌 / 巳酉丑(사유축)-丑 / 申子辰(신자진)-辰)

#### 주요 살성
- **空亡(공망)** 일주 旬(순)에서 빠진 지지 (甲子旬(갑자순)-戌亥 / 甲戌旬(갑술순)-申酉 / 甲申旬(갑신순)-午未 / 甲午旬(갑오순)-辰巳 / 甲辰旬(갑진순)-寅卯 / 甲寅旬(갑인순)-子丑)
- **양인살** 일간별 극한의 에너지 (甲-卯 / 乙-寅 / 丙-午 / 丁-巳 / 戊-午 / 己-巳 / 庚-酉 / 辛-申 / 壬-子 / 癸-亥)
- **괴강살** 庚辰 庚戌 壬辰 戊戌 일주 해당 여부
- **백호대살** 甲辰 乙未 丙戌 丁丑 戊辰 壬戌 癸丑 조합
- **원진살/귀문관살** 지지 간 특정 불화 조합 (子未 丑午 寅巳/寅未 卯辰/卯申 申亥 酉戌/酉午 등)

## 표시 데이터

### 원국
- 천간/지지 8자
- 오행 木(#66BB6A) 火(#EF5350) 土(#FFCA28) 金(#BDBDBD) 水(#42A5F5)
- 음양 양(흰글자), 음(검은글자)

### 십신
- 일간 기준 오행관계
  - **比劫(비겁)** 같은 오행 (**比肩(비견)**=같은음양, **劫財(겁재)**=다른음양)
  - **食傷(식상)** 일간이 생하는 오행 (**食神(식신)**=같은음양, **傷官(상관)**=다른음양)
  - **財星(재성)** 일간이 극하는 오행 (**偏財(편재)**=같은음양, **正財(정재)**=다른음양)
  - **官星(관성)** 일간을 극하는 오행 (**偏官(편관)**=같은음양, **正官(정관)**=다른음양)
  - **印星(인성)** 일간을 생하는 오행 (**偏印(편인)**=같은음양, **正印(정인)**=다른음양)
- 지지 십신 장간(본기) 기준
- 지장간 십신 본기/중기/여기 각각 계산

### 지장간 
```
子 癸        丑 己癸辛     寅 甲丙戊     卯 乙
辰 戊乙癸     巳 丙庚戊     午 丁己       未 己丁乙
申 庚壬戊     酉 辛        戌 戊辛丁     亥 壬甲
```

### 천간 합충
- **五合(오합) 甲己→土, 乙庚→金, 丙辛→水, 丁壬→木, 戊癸→火**
- **沖(충) 甲庚沖, 乙辛沖, 丙壬沖, 丁癸沖** (**戊己**는 **沖(충)** 없음)

### 지지 합충
- **六合(육합) 子丑→土, 寅亥→木, 卯戌→火, 辰酉→金, 巳申→水, 午未→土**
- **三合(삼합) 申子辰→水局, 亥卯未→木局, 寅午戌→火局, 巳酉丑→金局**
- **六沖(육충) 子午沖, 丑未沖, 寅申沖, 卯酉沖, 辰戌沖, 巳亥沖**

## 데이터 소스
- 절기 데이터 (1946-2024 한국천문연구원)
- 지장간/신살 《淵海子平》, 《三命通會》


## 환경설정

```bash
npm install
npx prisma db push
npm run dev
```

```env
DATABASE_URL="postgresql://..."
NEXT_PUBLIC_SUPABASE_URL="https://..."
NEXT_PUBLIC_SUPABASE_ANON_KEY="..."
```